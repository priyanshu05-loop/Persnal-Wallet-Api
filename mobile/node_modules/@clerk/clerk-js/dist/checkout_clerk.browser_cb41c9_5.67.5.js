"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{7075:function(e,t,o){o.r(t),o.d(t,{Checkout:()=>F});var r=o(9180),i=o(3812),n=o(3064),a=o(7718),l=o(9144),s=o(3003),c=o(2464),u=o(4676),d=o(43),m=o(3799),p=o(9626),h=o(903);let y=(0,l.createContext)(null),f=()=>{let e=(0,l.useContext)(y);if(!e)throw Error("CheckoutContextRoot not found");return e},g=()=>{let{planId:e,planPeriod:t,subscriberType:o="user"}=(0,i.useCheckoutContext)(),r=(0,m.cL)(),{organization:n}=(0,m.o8)(),{user:a}=(0,m.aF)(),s={key:"commerce-checkout",userId:a?.id,arguments:{..."org"===o?{orgId:n?.id}:{},planId:e,planPeriod:t}},{data:c,mutate:u}=(0,p.default)(s),{trigger:d,isMutating:y,error:f}=(0,h.Z)(s,e=>r.billing?.startCheckout(e.arguments),{throwOnError:!1,onSuccess:e=>{u(e,!1)}});return(0,l.useEffect)(()=>(d(),()=>{u(void 0,!1)}),[]),{checkout:c,startCheckout:d,updateCheckout:e=>u(e,!1),isMutating:y,errors:f?.errors}},k=({children:e})=>{let{planId:t}=(0,i.useCheckoutContext)(),{data:o,isLoading:n}=(0,i.usePlans)(),{checkout:a,isMutating:s,updateCheckout:c,errors:u,startCheckout:d}=g(),m=o?.find(e=>e.id===t),p=s||n,h=(0,l.useMemo)(()=>{if(p)return"pending";let e="completed";if(a?.status===e)return e;if(a)return"ready";let t="missing_payer_email";if(u?.some(e=>e.code===t))return t;let o="invalid_plan_change";return u?.[0]?.code===o&&m?o:"error"},[p,u,a,m?.id,a?.status]);return(0,r.tZ)(y.Provider,{value:{checkout:a,isLoading:p,updateCheckout:c,errors:u,startCheckout:d,plan:m,status:h},children:e})},b=({children:e,name:t})=>f().status!==t?null:e,x=e=>e[0].toUpperCase()+e.slice(1),S=(e,t,o)=>e+(t-e)*o,Z=()=>{let e=(0,u.useRouter)(),{setIsOpen:t}=(0,a.useDrawerContext)(),{newSubscriptionRedirectUrl:o}=(0,i.useCheckoutContext)(),{checkout:m}=f(),[p,h]=(0,l.useState)({x:256,y:256}),[y,g]=(0,l.useState)({x:256,y:256}),k=(0,c.Tb)(),{animations:b}=(0,n.useAppearance)().parsedLayout,Z=!k&&!0===b,B=(0,l.useRef)(null),w=(0,l.useRef)(null),$="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;return((0,l.useEffect)(()=>{if(!$)return;let e=()=>{g(e=>({x:S(e.x,p.x,.15),y:S(e.y,p.y,.15)})),B.current=requestAnimationFrame(e)};return B.current=requestAnimationFrame(e),()=>{B.current&&cancelAnimationFrame(B.current)}},[p,$]),m)?(0,r.BX)(r.HY,{children:[(0,r.tZ)(a.Drawer.Body,{children:(0,r.BX)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRoot,sx:e=>({"--ring-fill":e.colors.$neutralAlpha200,"--ring-highlight":e.colors.$success500,margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0,transformOrigin:"bottom center",animationName:"scaleIn",animationDuration:`${s.bf.slowest}ms`,animationTimingFunction:s.$$.bezier,animationFillMode:"forwards",opacity:0,overflow:"hidden",backgroundColor:e.colors.$colorBackground,"@keyframes scaleIn":{"0%":{filter:"blur(10px)",transform:"scale(0.85)",opacity:0},"100%":{filter:"blur(0px)",transform:"scale(1)",opacity:1}},...!Z&&{animation:"none",opacity:1}}),ref:w,onMouseMove:e=>{if($&&w.current){let t=w.current.getBoundingClientRect(),o=e.clientX-t.left,r=e.clientY-t.top,i=t.width;i>0?h({x:o/i*512,y:r/i*512}):h({x:256,y:256})}},children:[(0,r.BX)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessRings,as:"svg",viewBox:"0 0 512 512",sx:{position:"absolute",inset:0,pointerEvents:"none"},"aria-hidden":!0,children:[(0,r.BX)("defs",{children:[(0,r.BX)("radialGradient",{id:"clerk-checkout-success-gradient",children:[(0,r.tZ)("stop",{offset:"0%",style:{stopColor:"var(--ring-highlight)"}}),(0,r.tZ)("stop",{offset:"100%",stopOpacity:"0",style:{stopColor:"var(--ring-highlight)"}})]}),(0,r.tZ)("filter",{id:"clerk-checkout-success-blur-effect",children:(0,r.tZ)("feGaussianBlur",{stdDeviation:"10"})}),(0,r.tZ)("mask",{id:"clerk-checkout-success-mask",children:[{r:225,maskStart:10,maskEnd:90},{r:162.5,maskStart:15,maskEnd:85},{r:100,maskStart:20,maskEnd:80}].map(({r:e,maskStart:t,maskEnd:o})=>(0,r.tZ)("circle",{cx:"256",cy:"256",r:e,stroke:"white",fill:"none",style:{maskImage:`linear-gradient(to bottom, transparent ${t}%, black, transparent ${o}%)`}},e))})]}),(0,r.BX)("g",{mask:"url(#clerk-checkout-success-mask)",children:[(0,r.tZ)("rect",{width:"512",height:"512",style:{fill:"var(--ring-fill)"}}),$&&(0,r.tZ)("rect",{id:"movingGradientHighlight",width:"256",height:"256",x:y.x-128,y:y.y-128,fill:"url(#clerk-checkout-success-gradient)",filter:"url(#clerk-checkout-success-blur-effect)"})]})]}),(0,r.BX)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",color:$?e.colors.$success500:e.colors.$colorText,":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:[(0,r.tZ)("svg",{fill:"none",viewBox:"0 0 10 10","aria-hidden":"true",style:{position:"relative",margin:"auto",width:"1rem",height:"1rem"},children:(0,r.tZ)("path",{d:"m1 6 3 3 5-8",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"1",pathLength:"1",style:{strokeDashoffset:"1",animation:Z?`check ${s.bf.drawer}ms ${s.$$.bezier} forwards ${s.bf.slow}ms`:"none",...!Z&&{strokeDashoffset:"0"}}})}),(0,r.tZ)("style",{children:`
              @keyframes check {
                0% {
                  stroke-dashoffset: 1;
                }
                100% {
                  stroke-dashoffset: 0;
                }
            `})]}),(0,r.BX)(n.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:`translateY(${e.space.$20})`}),children:[(0,r.tZ)(n.Heading,{elementDescriptor:n.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:m.totals.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.title__paymentSuccessful"):(0,n.localizationKeys)("commerce.checkout.title__subscriptionSuccessful"),sx:e=>({opacity:0,animationName:"slideUp",animationDuration:`${s.bf.slowest}ms`,animationTimingFunction:s.$$.bezier,animationFillMode:"forwards",color:e.colors.$colorText,"@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!Z&&{opacity:1,animation:"none"}})}),(0,r.tZ)(n.Text,{elementDescriptor:n.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2,opacity:0,animationName:"slideUp",animationDuration:`${1.5*s.bf.slowest}ms`,animationTimingFunction:s.$$.bezier,animationFillMode:"forwards","@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!Z&&{opacity:1,animation:"none"}}),localizationKey:m.totals.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.description__paymentSuccessful"):(0,n.localizationKeys)("commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,r.BX)(a.Drawer.Footer,{sx:e=>({rowGap:e.space.$4,animationName:"footerSlideInUp",animationDuration:`${s.bf.drawer}ms`,animationTimingFunction:s.$$.bezier,"@keyframes footerSlideInUp":{"0%":{transform:"translateY(100%)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!Z&&{animation:"none"}}),children:[(0,r.BX)(a.LineItems.Root,{children:[(0,r.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("commerce.checkout.lineItems.title__totalPaid")}),(0,r.tZ)(a.LineItems.Description,{text:`${m.totals.totalDueNow.currencySymbol}${m.totals.totalDueNow.amountFormatted}`})]}),(0,r.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,r.tZ)(a.LineItems.Title,{title:m.totals.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.lineItems.title__paymentMethod"):(0,n.localizationKeys)("commerce.checkout.lineItems.title__subscriptionBegins")}),(0,r.tZ)(a.LineItems.Description,{text:m.totals.totalDueNow.amount>0?m.paymentSource?"card"!==m.paymentSource.paymentMethod?`${x(m.paymentSource.paymentMethod)}`:`${x(m.paymentSource.cardType)} ⋯ ${m.paymentSource.last4}`:"–":m.planPeriodStart?(0,d.p6)(new Date(m.planPeriodStart)):"–"})]})]}),(0,r.tZ)(n.Button,{onClick:()=>{o&&e.navigate(o),t&&t(!1)},localizationKey:(0,n.localizationKeys)("formButtonPrimary")})]})]}):null};var B=o(3610),w=o(1201),$=o(6771);let v=e=>e[0].toUpperCase()+e.slice(1),C=()=>{let e=f(),{onSubscriptionComplete:t}=(0,i.useCheckoutContext)(),{checkout:o,updateCheckout:l}=e;if(!o)return null;let{plan:s,planPeriod:c,totals:u,isImmediatePlanChange:d}=o,m=!!u.credit?.amount&&u.credit.amount>0,p=!!u.pastDue?.amount&&u.pastDue.amount>0;return(0,r.BX)(a.Drawer.Body,{children:[(0,r.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.BX)(a.LineItems.Root,{children:[(0,r.BX)(a.LineItems.Group,{children:[(0,r.tZ)(a.LineItems.Title,{title:s.name,description:"annual"===c?(0,n.localizationKeys)("commerce.billedAnnually"):void 0}),(0,r.tZ)(a.LineItems.Description,{prefix:"annual"===c?"x12":void 0,text:`${s.currencySymbol}${"month"===c?s.amountFormatted:s.annualMonthlyAmountFormatted}`,suffix:(0,n.localizationKeys)("commerce.checkout.perMonth")})]}),(0,r.BX)(a.LineItems.Group,{borderTop:!0,variant:"tertiary",children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("commerce.subtotal")}),(0,r.tZ)(a.LineItems.Description,{text:`${u.subtotal.currencySymbol}${u.subtotal.amountFormatted}`})]}),m&&(0,r.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("commerce.creditRemainder")}),(0,r.tZ)(a.LineItems.Description,{text:`- ${u.credit?.currencySymbol}${u.credit?.amountFormatted}`})]}),p&&(0,r.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("commerce.pastDue")}),(0,r.tZ)(a.LineItems.Description,{text:`${u.pastDue?.currencySymbol}${u.pastDue?.amountFormatted}`})]}),(0,r.BX)(a.LineItems.Group,{borderTop:!0,children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("commerce.totalDueToday")}),(0,r.tZ)(a.LineItems.Description,{text:`${u.totalDueNow.currencySymbol}${u.totalDueNow.amountFormatted}`})]})]})}),!d&&(0,r.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({paddingBlockStart:e.space.$4,paddingInline:e.space.$4}),children:(0,r.tZ)(n.Text,{localizationKey:(0,n.localizationKeys)("commerce.checkout.downgradeNotice"),variant:"caption",colorScheme:"secondary"})}),(0,r.tZ)(D,{checkout:o,onCheckoutComplete:e=>{l(e),t?.()}})]})},D=({checkout:e,onCheckoutComplete:t})=>{let{organization:o}=(0,m.o8)(),{subscriberType:s}=(0,i.useCheckoutContext)(),[c,u]=(0,l.useState)(!1),[p,h]=(0,l.useState)(),{data:y}=(0,i.usePaymentSources)(),{data:f}=y||{data:[]},[g,k]=(0,l.useState)(()=>f.length>0?"existing":"new"),b=async r=>{try{let i=await e.confirm({...r,..."org"===s?{orgId:o?.id}:{}});t(i)}catch(e){(0,d.S3)(e,[],h)}},x=async e=>{e.preventDefault(),u(!0),h(void 0);let t=new FormData(e.currentTarget).get("payment_source_id");await b({paymentSourceId:t,..."org"===s?{orgId:o?.id}:{}}),u(!1)},S=async e=>{await b({gateway:"stripe",paymentToken:e.stripeSetupIntent?.payment_method,..."org"===s?{orgId:o?.id}:{}}),u(!1)},Z=async()=>{try{let r=await e.confirm({gateway:"stripe",useTestCard:!0,..."org"===s?{orgId:o?.id}:{}});t(r)}catch(e){(0,d.S3)(e,[],h)}};return(0,r.BX)(n.Col,{elementDescriptor:n.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[f.length>0&&e.totals.totalDueNow.amount>0&&(0,r.BX)(a.SegmentedControl.Root,{"aria-label":"Payment method source",value:g,onChange:e=>k(e),size:"lg",fullWidth:!0,children:[(0,r.tZ)(a.SegmentedControl.Button,{value:"existing",text:(0,n.localizationKeys)("commerce.paymentMethods")}),(0,r.tZ)(a.SegmentedControl.Button,{value:"new",text:(0,n.localizationKeys)("commerce.addPaymentMethod")})]}),"existing"===g&&(0,r.tZ)(_,{checkout:e,paymentSources:f,totalDueNow:e.totals.totalDueNow,onPaymentSourceSubmit:x,isSubmitting:c,submitError:p}),"new"===g&&(0,r.tZ)($.M$,{checkout:e,onSuccess:S,onPayWithTestPaymentSourceSuccess:Z,submitLabel:e.totals.totalDueNow.amount>0?(0,n.localizationKeys)("userProfile.billingPage.paymentSourcesSection.formButtonPrimary__pay",{amount:`${e.totals.totalDueNow.currencySymbol}${e.totals.totalDueNow.amountFormatted}`}):(0,n.localizationKeys)("commerce.subscribe"),submitError:p,setSubmitError:h,showPayWithTestCardSection:!0})]})},_=({checkout:e,totalDueNow:t,paymentSources:o,onPaymentSourceSubmit:i,isSubmitting:s,submitError:c})=>{let[u,d]=(0,l.useState)(e.paymentSource||o.find(e=>e.isDefault)),m=(0,l.useMemo)(()=>o.map(e=>{let t="card"!==e.paymentMethod?`${v(e.paymentMethod)}`:`${v(e.cardType)} ⋯ ${e.last4}`;return{value:e.id,label:t}}),[o]);return(0,r.BX)(n.Form,{onSubmit:i,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[e.totals.totalDueNow.amount>0?(0,r.BX)(a.Select,{elementId:"paymentSource",options:m,value:u?.id||null,onChange:e=>{d(o.find(t=>t.id===e.value))},portal:!0,children:[(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:u?.id}),(0,r.tZ)(a.SelectButton,{icon:B.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:u&&(0,r.tZ)($.jr,{paymentSource:u})}),(0,r.tZ)(a.SelectOptionList,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}):(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:u?.id}),c&&(0,r.tZ)(a.Alert,{variant:"danger",sx:e=>({animation:`${w.animations.textInBig} ${e.transitionDuration.$slow}`}),children:"string"==typeof c?c:"longMessage"in c&&c.longMessage||c.message}),(0,r.tZ)(n.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:s,children:(0,r.tZ)(n.Text,{localizationKey:t.amount>0?(0,n.localizationKeys)("commerce.pay",{amount:`${t.currencySymbol}${t.amountFormatted}`}):(0,n.localizationKeys)("commerce.subscribe")})})]})};var z=o(9140);let P=()=>{let{errors:e}=f(),{translateError:t}=(0,n.useLocalizations)(),{t:o}=(0,n.useLocalizations)();return(0,r.tZ)(a.Drawer.Body,{children:(0,r.tZ)(n.Flex,{align:"center",justify:"center",sx:e=>({height:"100%",padding:e.space.$4,fontSize:e.fontSizes.$md}),children:(0,r.tZ)(a.Alert,{variant:"danger",colorScheme:"danger",children:e?t(e[0]):o((0,n.localizationKeys)("unstable__errors.form_param_value_invalid"))})})})},I=()=>{let{plan:e}=f(),{planPeriod:t}=(0,i.useCheckoutContext)();return e?(0,r.tZ)(a.Drawer.Body,{children:(0,r.BX)(n.Flex,{gap:4,direction:"col",children:[(0,r.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.tZ)(a.LineItems.Root,{children:(0,r.BX)(a.LineItems.Group,{children:[(0,r.tZ)(a.LineItems.Title,{title:e.name,description:"annual"===t?(0,n.localizationKeys)("commerce.billedAnnually"):void 0}),(0,r.tZ)(a.LineItems.Description,{prefix:"annual"===t?"x12":void 0,text:`${e.currencySymbol}${"month"===t?e.amountFormatted:e.annualMonthlyAmountFormatted}`,suffix:(0,n.localizationKeys)("commerce.checkout.perMonth")})]})})}),(0,r.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(a.Alert,{variant:"info",colorScheme:"info",title:(0,n.localizationKeys)("commerce.cannotSubscribeMonthly")})})]})}):null},L=()=>{let{startCheckout:e}=f(),{setIsOpen:t}=(0,a.useDrawerContext)();return(0,r.tZ)(a.Drawer.Body,{children:(0,r.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(z._,{title:(0,n.localizationKeys)("commerce.checkout.emailForm.title"),subtitle:(0,n.localizationKeys)("commerce.checkout.emailForm.subtitle"),onSuccess:e,onReset:()=>t(!1),disableAutoFocus:!0})})})},F=e=>(0,r.tZ)(n.Flow.Root,{flow:"checkout",children:(0,r.tZ)(n.Flow.Part,{children:(0,r.tZ)(i.SubscriberTypeContext.Provider,{value:e.subscriberType||"user",children:(0,r.tZ)(i.CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,r.BX)(a.Drawer.Content,{children:[(0,r.tZ)(a.Drawer.Header,{title:(0,n.localizationKeys)("commerce.checkout.title")}),(0,r.BX)(k,{children:[(0,r.tZ)(b,{name:"pending",children:(0,r.tZ)(n.Spinner,{sx:{margin:"auto"}})}),(0,r.tZ)(b,{name:"completed",children:(0,r.tZ)(Z,{})}),(0,r.tZ)(b,{name:"error",children:(0,r.tZ)(P,{})}),(0,r.tZ)(b,{name:"invalid_plan_change",children:(0,r.tZ)(I,{})}),(0,r.tZ)(b,{name:"missing_payer_email",children:(0,r.tZ)(L,{})}),(0,r.tZ)(b,{name:"ready",children:(0,r.tZ)(C,{})})]})]})})})})})},9140:function(e,t,o){o.d(t,{_:()=>k});var r=o(9180),i=o(3799),n=o(9144),a=o(8969),l=o(3812),s=o(7718),c=o(1085),u=o(43),d=o(207),m=o(4676),p=o(6917),h=o(3064),y=o(2464);let f=e=>{let{navigate:t}=(0,m.useRouter)(),{email:o,nextStep:i,onReset:a}=e,c=(0,s.useCardState)(),d=(0,l.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:f}=(0,y.eq)(o);async function g(){await t(o.verification.externalVerificationRedirectURL?.href||"")}return n.useEffect(()=>{!function(){let{mode:e,componentName:t}=d;f({redirectUrl:"modal"===e?(0,p.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>i()).catch(e=>(0,u.S3)(e,[],c.setError))}()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(h.Flex,{justify:"center",children:(0,r.tZ)(h.Button,{variant:"link",onClick:g,localizationKey:(0,h.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,r.tZ)(s.FormButtonContainer,{children:(0,r.tZ)(h.Button,{variant:"ghost",localizationKey:(0,h.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:h.descriptors.formButtonReset,onClick:a})})]})};var g=o(2786);let k=(0,s.withCardStateProvider)(e=>{let{emailId:t,onSuccess:o,onReset:m,disableAutoFocus:p=!1}=e,h=(0,s.useCardState)(),{user:y}=(0,i.aF)(),k=(0,l.useEnvironment)(),S=(0,i.WZ)(e=>y?.createEmailAddress({email:e})),Z=n.useRef(y?.emailAddresses.find(e=>e.id===t)),B=x(Z.current,k),w=(0,a.a2)({defaultStep:+!!Z.current,onNextStep:()=>h.setError(void 0)}),$=(0,u.Yp)("emailAddress","",{type:"email",label:(0,c.u1)("formFieldLabel__emailAddress"),placeholder:(0,c.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),v=$.value.length>1&&y?.username!==$.value,C=async e=>{if(e.preventDefault(),y)return S($.value).then(e=>{Z.current=e,w.nextStep()}).catch(e=>(0,u.S3)(e,[$],h.setError))},D=b(B);return(0,r.BX)(a.en,{...w.props,children:[(0,r.tZ)(s.FormContainer,{headerTitle:e.title||(0,c.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,c.u1)("userProfile.emailAddressPage.formHint"),children:(0,r.BX)(s.Form.Root,{onSubmit:C,children:[(0,r.tZ)(s.Form.ControlRow,{elementId:$.id,children:(0,r.tZ)(s.Form.PlainInput,{...$.props,autoFocus:!p})}),(0,r.tZ)(s.FormButtons,{submitLabel:(0,c.u1)("userProfile.formButtonPrimary__add"),isDisabled:!v,onReset:m})]})}),(0,r.BX)(s.FormContainer,{headerTitle:(0,c.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,c.u1)(`${D}.formSubtitle`,{identifier:Z.current?.emailAddress}),children:["email_link"===B&&(0,r.tZ)(g.K,{nextStep:o,email:Z.current,onReset:m}),"email_code"===B&&(0,r.tZ)(d.H,{nextStep:o,identification:Z.current,identifier:Z.current?.emailAddress,prepareVerification:()=>Z.current?.prepareVerification({strategy:"email_code"}),onReset:m}),"enterprise_sso"===B&&(0,r.tZ)(f,{nextStep:o,email:Z.current,onReset:m})]})]})}),b=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error(`Unsupported strategy for email verification: ${e}`)}},x=(e,t)=>e?.matchesSsoConnection?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:o}=t.attributes;return!!(o?.enabled&&o?.verifications.includes("email_link"))}(t)?"email_code":"email_link"},207:function(e,t,o){o.d(t,{H:()=>s});var r=o(9180),i=o(9144),n=o(3064),a=o(7718),l=o(43);let s=e=>{let t=(0,a.useCardState)(),{nextStep:o,identification:s,identifier:c,onReset:u,prepareVerification:d}=e,m=()=>d?.()?.catch(e=>l.S3(e,[],t.setError)),p=(0,a.useFieldOTP)({onCodeEntryFinished:(e,t,o)=>{s?.attemptVerification({code:e}).then(()=>t()).catch(o)},onResendCodeClicked:m,onResolve:o});return i.useEffect(()=>{m()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(a.Form.OTPInput,{...p,label:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:c}),resendButton:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,r.BX)(a.FormButtonContainer,{children:[(0,r.tZ)(n.Button,{isLoading:p.isLoading,localizationKey:(0,n.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:n.descriptors.formButtonPrimary,onClick:p.onFakeContinue}),(0,r.tZ)(n.Button,{variant:"ghost",isDisabled:p.isLoading,localizationKey:(0,n.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:n.descriptors.formButtonReset,onClick:u})]})]})}},2786:function(e,t,o){o.d(t,{K:()=>m,M:()=>p});var r=o(9180),i=o(9144),n=o(8969),a=o(6749),l=o(3812),s=o(3064),c=o(7718),u=o(2464),d=o(43);let m=e=>{let{email:t,nextStep:o,onReset:n}=e,m=(0,c.useCardState)(),p=(0,l.useUserProfileContext)(),{startEmailLinkFlow:h}=(0,u.E2)(t),{displayConfig:y}=(0,l.useEnvironment)();function f(){let{routing:e}=p,t="virtual"===e?y.userProfileUrl:"";h({redirectUrl:(0,a.Uu)({ctx:p,baseUrl:t,intent:"profile"})}).then(()=>o()).catch(e=>(0,d.S3)(e,[],m.setError))}return i.useEffect(()=>{f()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(c.VerificationLink,{resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:f}),(0,r.tZ)(c.FormButtonContainer,{children:(0,r.tZ)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:n})})]})},p=()=>(0,r.tZ)(n.Ej,{title:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);