"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["780"],{86:function(e,t,i){i.r(t),i.d(t,{OrganizationSwitcher:()=>L});var o=i(9180),n=i(9144),r=i(3812),a=i(3064),c=i(7718),s=i(2464),l=i(3799),d=i(6917),p=i(8969),g=i(3929),u=i(3610),h=i(4676),z=i(1201),m=i(43),w=i(7484);let S=()=>{let{userInvitations:e,userSuggestions:t}=(0,l.eW)(w.AO),{ref:i}=(0,s.YD)({threshold:0,onChange:i=>{i&&(e.hasNextPage?e.fetchNext?.():t.fetchNext?.())}});return{userInvitations:e,userSuggestions:t,ref:i}},v=e=>{let t=(0,c.useCardState)(),{userSuggestions:i}=(0,l.eW)({userSuggestions:w.AO.userSuggestions});return"accepted"===e.status?(0,o.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("organizationSwitcher.suggestionsAcceptedLabel")}):(0,o.tZ)(a.Button,{elementDescriptor:a.descriptors.organizationSwitcherInvitationAcceptButton,textVariant:"buttonSmall",variant:"outline",colorScheme:"neutral",size:"sm",isLoading:t.isLoading,onClick:()=>t.runAsync(e.accept).then(e=>i?.setData?.(t=>w.Sz(e,t))).catch(e=>(0,m.S3)(e,[],t.setError)),localizationKey:(0,a.localizationKeys)("organizationSwitcher.action__suggestionsAccept")})},x=e=>{let t=(0,c.useCardState)();return(0,o.tZ)(a.Button,{elementDescriptor:a.descriptors.organizationSwitcherInvitationAcceptButton,textVariant:"buttonSmall",variant:"outline",colorScheme:"neutral",size:"xs",isLoading:t.isLoading,onClick:e.onAccept,localizationKey:(0,a.localizationKeys)("organizationSwitcher.action__invitationAccept")})},$=e=>{let{children:t,publicOrganizationData:i}=e;return(0,o.BX)(a.Flex,{align:"center",gap:2,sx:e=>({justifyContent:"space-between",padding:`${e.space.$4} ${e.space.$5}`}),elementDescriptor:a.descriptors.organizationSwitcherPopoverInvitationActionsBox,children:[(0,o.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcherListedOrganization",organization:i,sx:e=>({color:e.colors.$colorTextSecondary,":hover":{color:e.colors.$colorTextSecondary}})}),t]})},B=(0,c.withCardStateProvider)(e=>{let{invitation:t,onOrganizationClick:i}=e,{accept:n,publicOrganizationData:s,status:d}=t,p=(0,c.useCardState)(),{getOrganization:g}=(0,l.cL)(),{organization:h}=(0,l.o8)(),{userInvitations:z}=(0,l.eW)({userInvitations:w.AO.userInvitations,userMemberships:w.AO.userMemberships}),{acceptedInvitations:S,setAcceptedInvitations:v}=(0,r.useAcceptedInvitations)(),B=S.find(e=>e.invitation.id===t.id)?.organization;return"accepted"===d?B?.id&&h?.id===B.id?null:(0,o.tZ)(c.PreviewButton,{elementDescriptor:a.descriptors.organizationSwitcherPreviewButton,icon:u.nR,onClick:B?()=>i(B):void 0,role:"menuitem",children:(0,o.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcherListedOrganization",organization:s,sx:e=>({color:e.colors.$colorTextSecondary,":hover":{color:e.colors.$colorTextSecondary}})})}):(0,o.tZ)($,{publicOrganizationData:s,children:(0,o.tZ)(x,{onAccept:()=>p.runAsync(async()=>[await n(),await g(s.id)]).then(([e,t])=>{z?.setData?.(t=>w.Sz(e,t,"negative")),v(i=>[...i,{organization:t,invitation:e}])}).catch(e=>(0,m.S3)(e,[],p.setError))})})}),P=e=>{let{showBorder:t,...i}=e;return(0,o.tZ)(c.Actions,{role:"menu",...i})},f=(0,c.withCardStateProvider)(e=>(0,o.tZ)($,{publicOrganizationData:e.publicOrganizationData,children:(0,o.tZ)(v,{...e})})),A=e=>{let{onOrganizationClick:t}=e,{ref:i,userSuggestions:n,userInvitations:r}=S(),c=r.isLoading||n.isLoading,s=r.hasNextPage||n.hasNextPage,l=r.data?.filter(e=>!!e)||[],d=n.data?.filter(e=>!!e)||[],g=l.length>0||d.length>0;return g||c?(0,o.tZ)(P,{showBorder:g||c,elementDescriptor:a.descriptors.organizationSwitcherPopoverInvitationActions,children:(0,o.BX)(a.Box,{sx:e=>({maxHeight:`calc(4 * ${e.sizes.$17} + 4px)`,overflowY:"auto",...z.common.unstyledScrollbar(e)}),children:[l?.map(e=>o.tZ(B,{invitation:e,onOrganizationClick:t},e.id)),!r.hasNextPage&&d?.map(e=>o.tZ(f,{...e},e.id)),(s||c)&&(0,o.tZ)(p.q7,{ref:i})]})}):null},b=()=>{let{userMemberships:e}=(0,l.eW)({userMemberships:w.AO.userMemberships}),{ref:t}=(0,s.YD)({threshold:0,onChange:t=>{t&&e.hasNextPage&&e.fetchNext?.()}});return{userMemberships:e,ref:t}},Z=e=>{let{onPersonalWorkspaceClick:t,onOrganizationClick:i}=e,{hidePersonal:n}=(0,r.useOrganizationSwitcherContext)(),{organization:s}=(0,l.o8)(),{ref:d,userMemberships:g}=b(),{user:h}=(0,l.aF)(),m=((g.count||0)>0&&g.data||[]).map(e=>e.organization).filter(e=>e.id!==s?.id);if(!h)return null;let{username:w,primaryEmailAddress:S,primaryPhoneNumber:v,...x}=h,{isLoading:$,hasNextPage:B}=g;return(0,o.BX)(a.Box,{sx:e=>({maxHeight:`calc((4 * ${e.sizes.$17}) + 4px)`,overflowY:"auto","> button,div":{border:`0 solid ${e.colors.$neutralAlpha100}`},">:not([hidden])~:not([hidden])":{borderTopWidth:"1px",borderBottomWidth:"0"},...z.common.unstyledScrollbar(e)}),role:"group","aria-label":n?"List of all organization memberships":"List of all accounts",children:[s&&!n&&(0,o.tZ)(c.PreviewButton,{elementDescriptor:a.descriptors.organizationSwitcherPreviewButton,elementId:a.descriptors.organizationSwitcherPreviewButton.setId("personal"),icon:u.nR,onClick:t,role:"menuitem",children:(0,o.tZ)(c.PersonalWorkspacePreview,{user:x,mainIdentifierVariant:"buttonLarge",title:(0,a.localizationKeys)("organizationSwitcher.personalWorkspace")})}),m.map(e=>(0,o.tZ)(c.PreviewButton,{elementDescriptor:a.descriptors.organizationSwitcherPreviewButton,elementId:a.descriptors.organizationSwitcherPreviewButton.setId("organization"),icon:u.nR,onClick:()=>i(e),role:"menuitem",sx:e=>({border:`0 solid ${e.colors.$neutralAlpha100}`}),children:(0,o.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcherListedOrganization",organization:e})},e.id)),(B||$)&&(0,o.tZ)(p.q7,{ref:d})]})},I=({onCreateOrganizationClick:e})=>{let{user:t}=(0,l.aF)();return t?.createOrganizationEnabled?(0,o.tZ)(c.Action,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActionButton,elementId:a.descriptors.organizationSwitcherPopoverActionButton.setId("createOrganization"),iconBoxElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:a.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("createOrganization"),iconElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:a.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("createOrganization"),icon:u.mm,label:(0,a.localizationKeys)("organizationSwitcher.action__createOrganization"),onClick:e,sx:e=>({padding:`${e.space.$5} ${e.space.$5}`}),iconSx:e=>({width:e.sizes.$9,height:e.sizes.$6}),iconBoxSx:e=>({width:e.sizes.$9,height:e.sizes.$6}),spinnerSize:"sm"}):null},O=e=>{let{onCreateOrganizationClick:t,onPersonalWorkspaceClick:i,onOrganizationClick:n}=e;return(0,o.BX)(o.HY,{children:[(0,o.tZ)(A,{onOrganizationClick:n}),(0,o.tZ)(Z,{onPersonalWorkspaceClick:i,onOrganizationClick:n}),(0,o.tZ)(I,{onCreateOrganizationClick:t})]})},C=n.forwardRef((e,t)=>{let{close:i,...n}=e,s=()=>i?.(!1),p=(0,c.useCardState)(),{__experimental_asStandalone:z}=(0,r.useOrganizationSwitcherContext)(),{openOrganizationProfile:m,openCreateOrganization:w}=(0,l.cL)(),{organization:S}=(0,l.o8)(),{isLoaded:v,setActive:x}=(0,l.eW)(),$=(0,h.useRouter)(),{hidePersonal:B,__unstable_manageBillingUrl:P,__unstable_manageBillingLabel:f,__unstable_manageBillingMembersLimit:A,createOrganizationMode:b,organizationProfileMode:Z,afterLeaveOrganizationUrl:I,afterCreateOrganizationUrl:C,navigateCreateOrganization:k,navigateOrganizationProfile:D,afterSelectOrganizationUrl:_,afterSelectPersonalUrl:L,organizationProfileProps:R,skipInvitationScreen:W,hideSlug:E}=(0,r.useOrganizationSwitcherContext)(),{user:T}=(0,l.aF)();if(!T)return null;let{username:F,primaryEmailAddress:K,primaryPhoneNumber:N,...X}=T;if(!v)return null;let M=()=>(s(),"navigation"===Z)?D():m({...R,afterLeaveOrganizationUrl:I,__unstable_manageBillingUrl:P,__unstable_manageBillingLabel:f,__unstable_manageBillingMembersLimit:A}),Y=(0,o.tZ)(c.SmallAction,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActionButton,elementId:a.descriptors.organizationSwitcherPopoverActionButton.setId("manageOrganization"),iconBoxElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:a.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("manageOrganization"),iconElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:a.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("manageOrganization"),icon:u.tc,label:(0,a.localizationKeys)("organizationSwitcher.action__manageOrganization"),onClick:()=>M(),trailing:(0,o.tZ)(y,{})}),j=(0,o.tZ)(c.SmallAction,{icon:u.Nj,label:(0,d.OR)(f)||"Upgrade",onClick:()=>$.navigate((0,d.OR)(P))});return(0,o.tZ)(g.r,{elementDescriptor:a.descriptors.organizationSwitcherPopoverRootBox,children:(0,o.BX)(c.PopoverCard.Root,{elementDescriptor:a.descriptors.organizationSwitcherPopoverCard,ref:t,role:"dialog","aria-label":`${S?.name} is active`,shouldEntryAnimate:!z,...n,children:[(0,o.tZ)(c.PopoverCard.Content,{elementDescriptor:a.descriptors.organizationSwitcherPopoverMain,children:(0,o.BX)(c.Actions,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActions,role:"menu",children:[S?P?(0,o.BX)(o.HY,{children:[(0,o.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcherActiveOrganization",organization:S,user:T,fetchRoles:!0,mainIdentifierVariant:"buttonLarge",sx:e=>({padding:`${e.space.$4} ${e.space.$5}`})}),(0,o.tZ)(c.Actions,{role:"menu",sx:e=>({borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,o.BX)(a.Flex,{justify:"between",sx:e=>({marginLeft:e.space.$12,padding:`0 ${e.space.$5} ${e.space.$4}`,gap:e.space.$2}),children:[Y,j]})})]}):(0,o.BX)(a.Flex,{justify:"between",align:"center",sx:e=>({width:"100%",paddingRight:e.space.$5}),children:[(0,o.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcherActiveOrganization",organization:S,user:T,fetchRoles:!0,mainIdentifierVariant:"buttonLarge",sx:e=>({padding:`${e.space.$4} ${e.space.$5}`})}),(0,o.tZ)(c.Actions,{role:"menu",children:Y})]}):!B&&(0,o.tZ)(c.PersonalWorkspacePreview,{user:X,sx:e=>({padding:`${e.space.$4} ${e.space.$5}`,width:"100%"}),title:(0,a.localizationKeys)("organizationSwitcher.personalWorkspace")}),(0,o.tZ)(O,{onCreateOrganizationClick:()=>(s(),"navigation"===b)?k():w({afterCreateOrganizationUrl:C,skipInvitationScreen:W,hideSlug:E}),onPersonalWorkspaceClick:()=>p.runAsync(()=>x({organization:null,redirectUrl:L(T)})).then(s),onOrganizationClick:e=>p.runAsync(()=>x({organization:e,redirectUrl:_(e)})).then(s)})]})}),(0,o.tZ)(c.PopoverCard.Footer,{elementDescriptor:a.descriptors.organizationSwitcherPopoverFooter})]})})}),y=(0,p.Ci)(({sx:e})=>{let{organizationSettings:t}=(0,r.useEnvironment)(),i=t?.domains?.enabled,{membershipRequests:n}=(0,l.o8)({membershipRequests:i||void 0});return n?.count?(0,o.tZ)(p.dN,{notificationCount:n.count,containerSx:e}):null},{permission:"org:sys_memberships:manage"}),k=(0,c.withAvatarShimmer)((0,n.forwardRef)((e,t)=>{let{sx:i,...n}=e,{user:s}=(0,l.aF)(),{organization:d}=(0,l.o8)(),{hidePersonal:p}=(0,r.useOrganizationSwitcherContext)();if(!s)return null;let{username:g,primaryEmailAddress:h,primaryPhoneNumber:z,...m}=s;return(0,o.BX)(a.Button,{elementDescriptor:a.descriptors.organizationSwitcherTrigger,elementId:a.descriptors.organizationSwitcherTrigger.setId(d?"organization":"personal"),variant:"ghost",colorScheme:"neutral",hoverAsFocus:!0,focusRing:!1,sx:[e=>({padding:`${e.space.$1} ${e.space.$2}`,position:"relative"}),i],ref:t,"aria-label":`${e.isOpen?"Close":"Open"} organization switcher`,"aria-expanded":e.isOpen,"aria-haspopup":"dialog",...n,children:[d&&(0,o.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcherTrigger",gap:3,size:"xs",fetchRoles:!0,organization:d,sx:{maxWidth:"30ch"}}),!d&&(0,o.tZ)(c.PersonalWorkspacePreview,{size:"xs",gap:3,user:m,showAvatar:!p,sx:e=>({color:e.colors.$colorTextSecondary}),title:p?(0,a.localizationKeys)("organizationSwitcher.notSelected"):(0,a.localizationKeys)("organizationSwitcher.personalWorkspace")}),(0,o.tZ)(D,{}),(0,o.tZ)(a.Icon,{elementDescriptor:a.descriptors.organizationSwitcherTriggerIcon,icon:u._M,sx:e=>({marginLeft:`${e.space.$2}`})})]})})),D=()=>{let{userInvitations:e,userSuggestions:t}=(0,l.eW)(w.AO),{organizationSettings:i}=(0,r.useEnvironment)(),n=(0,p.N2)({permission:"org:sys_memberships:manage"}),a=i?.domains?.enabled,{membershipRequests:c}=(0,l.o8)({membershipRequests:a&&n||void 0}),s=(e.count||0)+(t.count||0)+(c?.count||0);return s?(0,o.tZ)(p.dN,{containerSx:e=>({position:"absolute",top:`-${e.space.$2}`,right:`-${e.space.$2}`}),notificationCount:s}):null},_=(0,c.withFloatingTree)(({children:e})=>{let{defaultOpen:t}=(0,r.useOrganizationSwitcherContext)(),{floating:i,reference:a,styles:l,toggle:d,isOpen:p,nodeId:g,context:u}=(0,s.Sv)({defaultOpen:t,placement:"bottom-start",offset:8}),h=(0,n.useId)();return(0,o.BX)(o.HY,{children:[(0,o.tZ)(k,{ref:a,onClick:d,isOpen:p,"aria-controls":p?h:void 0,"aria-expanded":p}),(0,o.tZ)(c.Popover,{nodeId:g,context:u,isOpen:p,children:(0,n.cloneElement)(e,{id:h,close:d,ref:i,style:l})})]})}),L=(0,r.withCoreUserGuard)((0,c.withCardStateProvider)(()=>{let{__experimental_asStandalone:e}=(0,r.useOrganizationSwitcherContext)();return(0,o.tZ)(a.Flow.Root,{flow:"organizationSwitcher",sx:{display:"inline-flex"},children:(0,o.tZ)(r.AcceptedInvitationsProvider,{children:e?(0,o.tZ)(C,{close:"function"==typeof e?e:void 0}):(0,o.tZ)(_,{children:(0,o.tZ)(C,{})})})})}))},7484:function(e,t,i){i.d(t,{AO:()=>o,Sz:()=>n});let o={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},n=(e,t,i)=>{if(void 0===t)return[{data:[e],total_count:1}];let o=t?.[t.length-1]?.total_count||1;return t.map(t=>{if(void 0===t)return t;let n=t.data.map(t=>t.id===e.id?{...e}:t);return{...t,data:n,total_count:"negative"===i?o-1:o}})}}}]);